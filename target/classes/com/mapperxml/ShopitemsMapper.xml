<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.ShopitemsMapper">
  <resultMap id="BaseResultMap" type="com.bean.Shopitems">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="item_id" jdbcType="INTEGER" property="itemId" />
    <result column="item_goods" jdbcType="INTEGER" property="itemGoods" />
    <result column="item_price" jdbcType="DOUBLE" property="itemPrice" />
    <result column="item_num" jdbcType="INTEGER" property="itemNum" />
    <result column="item_user" jdbcType="INTEGER" property="itemUser" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from shopitems
    where item_id = #{itemId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.bean.Shopitems">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into shopitems (item_id, item_goods, item_price, 
      item_num, item_user)
    values (#{itemId,jdbcType=INTEGER}, #{itemGoods,jdbcType=INTEGER}, #{itemPrice,jdbcType=DOUBLE}, 
      #{itemNum,jdbcType=INTEGER}, #{itemUser,jdbcType=INTEGER})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.bean.Shopitems">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update shopitems
    set item_goods = #{itemGoods,jdbcType=INTEGER},
      item_price = #{itemPrice,jdbcType=DOUBLE},
      item_num = #{itemNum,jdbcType=INTEGER},
      item_user = #{itemUser,jdbcType=INTEGER}
    where item_id = #{itemId,jdbcType=INTEGER}
  </update>

  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select item_id, item_goods, item_price, item_num, item_user
    from shopitems
    where item_id = #{itemId,jdbcType=INTEGER}
  </select>

  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select item_id, item_goods, item_price, item_num, item_user
    from shopitems
  </select>

  <sql id="Base_Column_List">
		item_id, item_goods, item_price, item_num, item_user
	</sql>

  <!--======== 根据购物车里面商品的id和当前用户id查询这个购物车对象========= 开始 -->
  <select id="selectByGoodsIdandUsersId" resultMap="BaseResultMap"
          parameterType="com.bean.Shopitems">
    select
    <include refid="Base_Column_List" />
    from shopitems
    where item_goods = #{itemGoods} and item_user =
    #{itemUser}
  </select>
  <!-- =========根据购物车里面商品的id和当前用户id查询这个购物车对象======== 结束 -->


  <!-- 查询当前登陆用户的购物车集合对象信息====开始 -->
  <resultMap type="map" id="selectShopitemsByUsersIdresultMap">
    <!-- column=查询语句里面数据库列的名字 -->
    <!-- property=封装对象里面的属性名字 -->
    <id column="item_id" property="item_id" />
    <result column="item_goods" property="item_goods" />
    <result column="item_price" property="item_price" />
    <result column="item_num" property="item_num" />
    <result column="goods_id" property="goods_id" />
    <result column="goods_name" property="goods_name" />
    <result column="goods_price" property="goods_price" />
    <result column="goods_img" property="goods_img" />

  </resultMap>

  <select id="selectShopitemsByUsersId" parameterType="int"
          resultMap="selectShopitemsByUsersIdresultMap">
		select
		a.item_id,a.item_goods,a.item_price,a.item_num,b.goods_id,b.goods_name,b.goods_price,b.goods_img
		from shopitems a inner join goods b on item_user=#{usersid} and
		a.item_goods=b.goods_id
	</select>
  <!-- 查询当前登陆用户的购物车集合对象信息====结束 -->

  <update id="updateByPrimaryKeySelective" parameterType="com.bean.Shopitems">
    update shopitems
    <set>
      <if test="itemGoods != null">
        item_goods = #{itemGoods,jdbcType=INTEGER},
      </if>
      <if test="itemPrice != null">
        item_price = #{itemPrice,jdbcType=DOUBLE},
      </if>
      <if test="itemNum != null">
        item_num = #{itemNum,jdbcType=INTEGER},
      </if>
      <if test="itemUser != null">
        item_user = #{itemUser,jdbcType=INTEGER},
      </if>
    </set>
    where item_id = #{itemId,jdbcType=INTEGER}
  </update>


  <!-- 结算的时候，根据购物车选中的购物车id数组返回购物车集合对象===开始 -->
  <select id="selectShopitemsById" resultMap="selectShopitemsByUsersIdresultMap">
		select
		a.item_id,a.item_goods,a.item_price,a.item_num,b.goods_id,b.goods_name,b.goods_price,b.goods_img
		from shopitems a inner join goods b on a.item_user=#{param1} and a.item_id
		in (${param2}) and
		a.item_goods=b.goods_id
	</select>
  <!-- 结算的时候，根据购物车选中的购物车id数组返回购物车集合对象===结束  -->

  <!-- 根据购物车的id数组字符串获取购物车集合对象 -->
  <select id="selectByArrid" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />
    from shopitems where item_id in(${param1})
  </select>

</mapper>